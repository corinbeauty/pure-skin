<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç€…ç™½ä¹‹å¢ƒ Pure Skin - V3.4</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, signInAnonymously, signInWithPopup, GoogleAuthProvider, OAuthProvider, signInWithCustomToken,
            onAuthStateChanged, setPersistence, browserLocalPersistence, signOut 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Firebase ç’°å¢ƒè®Šæ•¸èˆ‡åˆå§‹åŒ– ---
        const firebaseConfig = JSON.parse(__firebase_config);
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'pure-skin-studio-master';

        // --- å‚™æ´é…ç½®èˆ‡æ•…äº‹è³‡æ–™åº« (20ç¨®åŠ‡æœ¬) ---
        const FALLBACK_DATA = {
            bodyParts: {
                face: { name: 'è‡‰éƒ¨ç™‚ç¨‹', icon: 'ğŸ‘¤', cost: 100, desc: 'ä¸Šå”‡ã€ä¸‹å·´ç²¾ç´°è­·ç†ã€‚' },
                underarm: { name: 'è…‹ä¸‹è­·ç†', icon: 'âœ¨', cost: 150, desc: 'æƒé™¤é»‘é ­æ²‰ç©ã€‚' },
                bikini: { name: 'VIO ç§å¯†', icon: 'ğŸ‘™', cost: 480, desc: 'æ¥µè‡´è¦ªè†šæŠ€è¡“ï¼Œæº«æŸ”å‘µè­·ã€‚' },
                limbs: { name: 'å››è‚¢é™¤æ¯›', icon: 'ğŸ¦µ', cost: 220, desc: 'æ‰“é€ å¤§é¢ç©çµ²æ»‘è‚Œã€‚' }
            },
            careerTitles: ["ç€…ç™½å¯¦ç¿’ç”Ÿ", "åˆç´šæŠ€å¸«", "è³‡æ·±é™¤æ¯›å¸«", "é¦–å¸­æŠ€è¡“å®˜", "é†«ç¾é¡§å•", "é›·å°„ç‰©ç†å°ˆå®¶", "çš®è†šè‡¨åºŠé†«ç”Ÿ", "æŠ—è€ç ”ç©¶å“¡", "ç”Ÿç‰©çº–ç¶­å°ˆå®¶", "é†«å­¸ç¾å®¹é™¢é•·", "å©šç¦®é€ å‹å¸«", "æ™‚å°šé›œèªŒé¡§å•", "å¥½èŠå¡¢ç‰¹æ•ˆè­·ç†", "æ˜æ˜Ÿå¾¡ç”¨å¤§å¸«", "äººé«”ç¾å­¸å®¶", "æ²™é¾åº—é•·", "å“ç‰Œç¶“ç†", "é€£é–åº—å‰µå§‹äºº", "ç¾å®¹é›†åœ˜ CEO", "å…¨çƒç¾å­¸æ•™çˆ¶"],
            stories: Array.from({length: 20}, (_, i) => ({
                id: i,
                title: `ç¾å®¹å€‹æ¡ˆ #${i + 1}`,
                text: [
                    `ä½ å¥½ï¼æˆ‘æ˜¯é ç´„è€…ã€‚æˆ‘çš„çš®è†šéå¸¸æ•æ„Ÿï¼Œé›·å°„èƒ½é‡å¯ä»¥å¹«æˆ‘èª¿ä½ä¸€é»å—ï¼Ÿ`,
                    `æˆ‘ä¸‹é€±è¦å»æµ·é‚Šæ‹è‡ªåŠ©å©šç´—ï¼Œå¸Œæœ›èƒ½å¹«æˆ‘æŠŠè…‹ä¸‹è™•ç†å¾—ä¹¾ä¹¾æ·¨æ·¨ã€‚`,
                    `é€™æ˜¯æˆ‘ç¬¬ä¸€æ¬¡å˜—è©¦ VIO ç™‚ç¨‹ï¼Œæˆ‘çœŸçš„å¾ˆç·Šå¼µ...`,
                    `è½èªªä½ å€‘é€™è£¡çš„ã€Œç€…ç™½æŠ€è¡“ã€æ˜¯å…¨çƒé ‚å°–çš„ï¼Ÿæˆ‘æƒ³è¦‹è­˜çœ‹çœ‹ã€‚`,
                    `æ•™çˆ¶ï¼Œæˆ‘æœ€è¿‘è¦ºå¾—æ¯›é«®é•·å¾—æœ‰é»ä¸å‡å‹»ï¼Œéœ€è¦æ‚¨å°ˆæ¥­çš„è©•ä¼°ã€‚`
                ][i % 5],
                options: [
                    { text: "æˆ‘å€‘æœƒä½¿ç”¨æœ€æº«å’Œçš„å†·æ„Ÿè„ˆè¡æŠ€è¡“ï¼Œè«‹æ”¾å¿ƒã€‚", response: "å¤ªæ£’äº†ï¼é‚£æˆ‘å°±æ”¾å¿ƒäº¤çµ¦ä½ äº†ã€‚" },
                    { text: "è¿½æ±‚æ¥µè‡´ç€…ç™½éœ€è¦ç²¾æº–çš„èƒ½é‡ï¼Œæˆ‘æœƒå¿«é€Ÿå®Œæˆã€‚", response: "å¾ˆæœ‰é“ç†ï¼Œå°ˆæ¥­äººå£«æœç„¶ä¸ä¸€æ¨£ã€‚" }
                ]
            }))
        };

        const CUSTOMER_NAMES = ["è‰¾ç±³è‰", "å‚‘å…‹", "éœ²è¥¿", "ç´¢è²äº", "é¦¬å…‹æ–¯", "å¥§è‰è–‡äº", "æ¹¯å§†", "å‡±ç‰¹", "ä¸¹å°¼çˆ¾", "å…‹æ´›ä¼Š"];

        // --- ç‹€æ…‹ç®¡ç† ---
        let state = {
            user: null, totalGold: 0, level: 1, exp: 0, careerIndex: 0,
            view: 'loading',
            bodyParts: FALLBACK_DATA.bodyParts, careerTitles: FALLBACK_DATA.careerTitles, stories: FALLBACK_DATA.stories,
            appointments: [], currentCustomer: null, currentStory: null,
            isCleaning: false, isMuted: true, isDefinitionsLoaded: false
        };

        // --- éŸ³é »ä¸­å¿ƒ ---
        const bgm = new Audio("https://assets.mixkit.co/music/preview/mixkit-serene-view-443.mp3");
        bgm.loop = true;
        bgm.volume = 0.4;

        window.toggleMusic = () => {
            state.isMuted = !state.isMuted;
            const icon = document.getElementById('music-icon');
            if (!state.isMuted) {
                bgm.play().catch(e => console.log("ç­‰å¾…é»æ“Šå•Ÿå‹•"));
                icon.innerText = "ğŸ”Š";
            } else {
                bgm.pause();
                icon.innerText = "ğŸ”‡";
            }
        };

        // --- ç‰¹æ•ˆï¼šé›·å°„é–ƒå…‰ ---
        function triggerLaserFX(x, y) {
            const fx = document.createElement('div');
            fx.className = 'laser-flash';
            fx.style.left = `${x}px`; fx.style.top = `${y}px`;
            document.body.appendChild(fx);
            setTimeout(() => fx.remove(), 400);
        }

        // --- åˆå§‹åŒ–ï¼šå¼·åˆ¶è§£æ±ºé€£ç·šå¡æ­» ---
        async function init() {
            console.log("ç€…ç™½ä¹‹å¢ƒï¼šV3.4 æ ¸å¿ƒå•Ÿå‹•...");
            
            // å®‰å…¨å‡ºå£ï¼š3ç§’è¶…æ™‚å¼·åˆ¶é€²å…¥
            const watchdog = setTimeout(() => {
                if (state.view === 'loading') {
                    console.warn("èªè­‰è¶…æ™‚ï¼Œå•Ÿå‹•å‚™æ´ç³»çµ±...");
                    state.isDefinitionsLoaded = true;
                    switchView('login');
                }
            }, 3000);

            onAuthStateChanged(auth, async (currUser) => {
                clearTimeout(watchdog);
                if (currUser) {
                    state.user = currUser;
                    await syncDefinitions();
                    await syncUserData();
                    generateAppointments();
                    if (state.view === 'loading') switchView('lobby');
                } else {
                    state.user = null;
                    await syncDefinitions();
                    switchView('login');
                }
            });

            // è§¸ç™¼ Auth
            if (!auth.currentUser) {
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    signInWithCustomToken(auth, __initial_auth_token).catch(() => fallbackStart());
                } else {
                    signInAnonymously(auth).catch(() => fallbackStart());
                }
            }

            const probe = document.getElementById('laser-probe');
            window.addEventListener('mousemove', (e) => { 
                if (probe) { probe.style.left = `${e.clientX}px`; probe.style.top = `${e.clientY}px`; }
            });

            // éŸ³è¨Šå–šé†’
            window.addEventListener('mousedown', () => {
                if (!state.isMuted && bgm.paused) bgm.play();
            }, { once: true });
        }

        function fallbackStart() {
            state.isDefinitionsLoaded = true;
            if (state.view === 'loading') switchView('login');
        }

        async function syncDefinitions() {
            try {
                const defRef = doc(db, 'artifacts', appId, 'public', 'data', 'definitions', 'config');
                const snap = await getDoc(defRef);
                if (snap.exists()) {
                    const d = snap.data();
                    state.bodyParts = d.bodyParts || FALLBACK_DATA.bodyParts;
                    state.careerTitles = d.careerTitles || FALLBACK_DATA.careerTitles;
                    state.stories = d.stories || FALLBACK_DATA.stories;
                }
            } catch (err) {
                console.error("é›²ç«¯é€£ç·šå¤±æ•—ï¼Œå·²è‡ªå‹•åŠ è¼‰æœ¬åœ°å®šç¾©");
            } finally {
                state.isDefinitionsLoaded = true;
                updateUI();
            }
        }

        async function syncUserData() {
            if (!state.user) return;
            onSnapshot(doc(db, 'artifacts', appId, 'users', state.user.uid, 'saveData', 'profile'), (snap) => {
                if (snap.exists()) { Object.assign(state, snap.data()); updateUI(); }
            }, () => null);
        }

        // --- è¦–è¦ºæ¸²æŸ“å¼•æ“ ---
        function renderAvatar(gender, targetId) {
            const color = gender === 'male' ? '#bae6fd' : '#fecdd3';
            const hair = gender === 'male' 
                ? 'M20,45 Q50,15 80,45 L80,35 Q50,5 20,35 Z' 
                : 'M10,50 Q50,-10 90,50 L95,100 L5,100 Z';
            const svg = `
                <svg viewBox="0 0 100 100" class="w-full h-full drop-shadow-xl animate-float">
                    <circle cx="50" cy="55" r="40" fill="white" stroke="${color}" stroke-width="2"/>
                    <path d="${hair}" fill="${color}" opacity="0.9"/>
                    <circle cx="38" cy="55" r="3" fill="#334155"/>
                    <circle cx="62" cy="55" r="3" fill="#334155"/>
                    <path d="M42,75 Q50,82 58,75" fill="none" stroke="#334155" stroke-width="2" stroke-linecap="round"/>
                    <circle cx="32" cy="65" r="4" fill="#fecaca" opacity="0.6"/>
                    <circle cx="68" cy="65" r="4" fill="#fecaca" opacity="0.6"/>
                </svg>
            `;
            const container = document.getElementById(targetId);
            if (container) container.innerHTML = svg;
        }

        function generateAppointments() {
            const keys = Object.keys(state.bodyParts);
            state.appointments = Array.from({length: 8}, (_, i) => ({
                id: i,
                name: CUSTOMER_NAMES[Math.floor(Math.random() * CUSTOMER_NAMES.length)],
                time: `${10 + i}:00`,
                gender: Math.random() > 0.5 ? 'female' : 'male',
                part: keys[Math.floor(Math.random() * keys.length)],
                status: i < 2 ? 'READY' : 'WAITING'
            }));
            if (state.view === 'appointments') renderAppointmentList();
        }

        function renderAppointmentList() {
            const list = document.getElementById('appointment-list');
            if (!list) return;
            list.innerHTML = state.appointments.map((app, idx) => `
                <div class="flex items-center justify-between p-5 bg-white/70 rounded-[2.5rem] border border-blue-50 hover:bg-blue-100 hover:scale-[1.02] transition-all cursor-pointer shadow-sm mb-4 animate-slide-in" style="animation-delay: ${idx * 0.1}s" onclick="window.pickCustomer(${app.id})">
                    <div class="flex items-center gap-4">
                        <div class="w-14 h-14 bg-white rounded-3xl flex items-center justify-center text-2xl shadow-inner border border-blue-50">${app.gender === 'male' ? 'ğŸ‘¦' : 'ğŸ‘§'}</div>
                        <div>
                            <p class="font-black text-slate-700 text-lg">${app.name}</p>
                            <p class="text-[11px] font-bold text-blue-400 uppercase tracking-widest">${app.time} Â· ${state.bodyParts[app.part]?.name || 'ç‰¹æ®Šç™‚ç¨‹'}</p>
                        </div>
                    </div>
                    <span class="text-[10px] font-black px-4 py-2 rounded-full ${app.status === 'READY' ? 'bg-green-100 text-green-600' : 'bg-slate-100 text-slate-400'}">${app.status}</span>
                </div>
            `).join('');
        }

        window.pickCustomer = (id) => {
            state.currentCustomer = state.appointments[id];
            state.selectedGender = state.currentCustomer.gender;
            state.selectedPartId = state.currentCustomer.part;
            switchView('dialogue');
            startDialogue();
        };

        function startDialogue() {
            const story = state.stories[Math.floor(Math.random() * state.stories.length)];
            state.currentStory = story;
            document.getElementById('diag-name').innerText = state.currentCustomer.name;
            document.getElementById('diag-text').innerText = story.text;
            renderAvatar(state.currentCustomer.gender, 'diag-avatar-box');
            document.getElementById('diag-options').innerHTML = story.options.map((opt, i) => `
                <button onclick="window.chooseOption(${i})" class="w-full p-4 bg-white/90 rounded-3xl border border-blue-50 font-bold text-blue-600 hover:bg-blue-600 hover:text-white transition-all text-sm mb-3 shadow-sm text-left px-6">
                    â— ${opt.text}
                </button>
            `).join('');
        }

        window.chooseOption = (idx) => {
            const opt = state.currentStory.options[idx];
            document.getElementById('diag-text').innerText = opt.response;
            document.getElementById('diag-options').innerHTML = `
                <button onclick="switchView('selection')" class="w-full p-5 bg-blue-600 text-white rounded-3xl font-black shadow-xl hover:scale-[1.05] transition-transform">
                    å•Ÿå‹•å®¢è£½åŒ–è©•ä¼°æµç¨‹
                </button>
            `;
        };

        window.loginGoogle = () => signInWithPopup(auth, new GoogleAuthProvider()).catch(() => fallbackStart());
        window.loginGuest = () => switchView('lobby');
        window.logout = () => signOut(auth).then(() => window.location.reload());

        function switchView(v) {
            state.view = v;
            ['loading', 'login', 'lobby', 'appointments', 'dialogue', 'selection', 'game'].forEach(id => {
                const el = document.getElementById(`view-${id}`);
                if (el) el.classList.toggle('hidden', state.view !== id);
                if (el) el.classList.toggle('flex', state.view === id);
            });
            if (v === 'game') setTimeout(initCanvas, 100);
            if (v === 'appointments') renderAppointmentList();
            updateUI();
        }

        function updateUI() {
            document.querySelectorAll('.gold-val').forEach(el => el.innerText = state.totalGold);
            document.querySelectorAll('.level-val').forEach(el => el.innerText = `Lv.${state.level}`);
            const careerName = state.careerTitles[state.careerIndex] || "ç€…ç™½å­¸å“¡";
            document.querySelectorAll('.career-val').forEach(el => el.innerText = careerName);
            document.querySelectorAll('.user-name').forEach(el => el.innerText = state.user?.displayName || "èªè­‰å°ˆå®¶");
            if (state.view === 'selection') renderSelectionUI();
        }

        let canvas, ctx;
        function initCanvas() {
            canvas = document.getElementById('game-canvas');
            if (!canvas) return;
            ctx = canvas.getContext('2d');
            canvas.width = 340; canvas.height = 440;
            canvas.onmousedown = (e) => { state.isCleaning = true; document.getElementById('laser-probe').classList.add('active'); clean(e); };
            canvas.onmousemove = (e) => { if (state.isCleaning) { clean(e); triggerLaserFX(e.clientX, e.clientY); } };
            window.onmouseup = () => { state.isCleaning = false; document.getElementById('laser-probe').classList.remove('active'); checkProgress(); };
            drawSkin();
        }

        function clean(e) {
            const r = canvas.getBoundingClientRect();
            ctx.globalCompositeOperation = 'destination-out';
            ctx.beginPath(); ctx.arc(e.clientX - r.left, e.clientY - r.top, 25, 0, Math.PI * 2); ctx.fill();
        }

        function drawSkin() {
            ctx.globalCompositeOperation = 'source-over';
            ctx.fillStyle = state.selectedGender === 'male' ? '#f4d1c1' : '#fff0f0';
            ctx.fillRect(0, 0, 340, 440);
            ctx.strokeStyle = "#4a3a2a"; ctx.lineWidth = 0.8;
            for (let i = 0; i < 2800; i++) {
                const x = Math.random()*340; const y = Math.random()*440;
                ctx.beginPath(); ctx.moveTo(x, y); ctx.lineTo(x + (Math.random()-0.5)*2, y + 6); ctx.stroke();
            }
        }

        function checkProgress() {
            const data = ctx.getImageData(0,0,340,440).data;
            let opaque = 0;
            for (let i=3; i<data.length; i+=4) if(data[i]>0) opaque++;
            const progress = 1 - (opaque / (340*440));
            document.getElementById('prog-bar').style.width = `${progress * 100}%`;
            if (progress > 0.98) finalizeSession();
        }

        async function finalizeSession() {
            let reward = state.bodyParts[state.selectedPartId]?.cost || 50;
            if (state.selectedGender === 'male') reward *= 1.2;
            state.totalGold += Math.floor(reward);
            state.exp += 50;
            if (state.exp >= 100) { state.level++; state.exp = 0; state.careerIndex = Math.min(Math.floor(state.level / 2), 19); }
            if (state.user) await setDoc(doc(db, 'artifacts', appId, 'users', state.user.uid, 'saveData', 'profile'), { totalGold: state.totalGold, level: state.level, careerIndex: state.careerIndex }, { merge: true });
            document.getElementById('reward-val').innerText = Math.floor(reward);
            document.getElementById('result-modal').style.display = 'flex';
        }

        function renderSelectionUI() {
            const p = state.bodyParts[state.selectedPartId] || { name: 'å®šåˆ¶ç™‚ç¨‹', icon: 'â“', desc: 'æ•¸æ“šåŠ è¼‰ä¸­...', cost: 0 };
            document.getElementById('selection-detail').innerHTML = `
                <div class="p-8 bg-blue-50/70 rounded-[3rem] border border-blue-100 shadow-inner">
                    <div class="flex items-center gap-4 mb-3"><span class="text-4xl animate-pulse">${p.icon}</span><h3 class="text-2xl font-black text-blue-600">${p.name}</h3></div>
                    <p class="text-sm text-slate-500 font-medium leading-relaxed mb-6">${p.desc}</p>
                    <div class="mt-4 flex justify-between items-center border-t border-blue-100 pt-5">
                        <span class="text-xs font-bold text-slate-400 uppercase tracking-widest text-center">Reward Balance</span>
                        <span class="text-2xl font-black text-blue-800 font-mono">ğŸ’° ${p.cost}</span>
                    </div>
                </div>
            `;
            document.querySelectorAll('.hotspot').forEach(el => el.classList.toggle('active', el.dataset.id === state.selectedPartId));
        }

        window.onload = init;
        window.switchView = switchView;
        window.selectPart = (id) => { state.selectedPartId = id; renderSelectionUI(); };
        window.confirmStart = () => switchView('game');
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background: #fdfdfe; cursor: none; overflow: hidden; margin: 0; user-select: none; }
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(25px); border: 1px solid rgba(255, 255, 255, 0.6); }
        
        #laser-probe { 
            position: fixed; width: 54px; height: 54px; border: 3px solid #3b82f6; border-radius: 50%; pointer-events: none; z-index: 10000; transform: translate(-50%, -50%); 
            background: rgba(59, 130, 246, 0.1); box-shadow: 0 0 20px rgba(59, 130, 246, 0.4); transition: transform 0.1s ease-out; 
        }
        #laser-probe::before {
            content: ''; position: absolute; top: -10px; left: -10px; right: -10px; bottom: -10px; border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 50%; animation: pulse-fx 2s infinite;
        }
        #laser-probe.active { transform: translate(-50%, -50%) scale(0.75); background: rgba(59, 130, 246, 0.8); box-shadow: 0 0 60px #3b82f6; }
        #laser-probe::after { content: ''; position: absolute; top: 50%; left: 50%; width: 4px; height: 4px; background: white; border-radius: 50%; transform: translate(-50%, -50%); }
        
        .laser-flash { position: fixed; width: 40px; height: 40px; background: radial-gradient(circle, rgba(96, 165, 250, 0.9) 0%, transparent 70%); border-radius: 50%; pointer-events: none; z-index: 9999; transform: translate(-50%, -50%); animation: flash-fade 0.4s ease-out forwards; }

        .brand-btn { background: linear-gradient(135deg, #a5f3fc 0%, #e0f2fe 100%); color: #0369a1; font-weight: 900; cursor: pointer; transition: 0.3s; }
        .brand-btn:hover { transform: translateY(-3px); box-shadow: 0 10px 25px rgba(186, 230, 253, 0.5); }
        
        .hotspot { fill: #f8fafc; stroke: #e2e8f0; cursor: pointer; transition: 0.3s; }
        .hotspot.active { fill: #3b82f6; stroke: #1d4ed8; stroke-width: 2.5; filter: drop-shadow(0 0 10px rgba(59, 130, 246, 0.5)); }
        
        canvas { border-radius: 4.5rem; border: 12px solid white; box-shadow: 0 30px 70px rgba(186, 230, 253, 0.2); background: white; }

        @keyframes pulse-fx { 0% { transform: scale(1); opacity: 0.8; } 100% { transform: scale(1.6); opacity: 0; } }
        @keyframes flash-fade { 0% { transform: translate(-50%, -50%) scale(0.5); opacity: 1; } 100% { transform: translate(-50%, -50%) scale(2); opacity: 0; } }
        @keyframes slide-in { from { transform: translateY(25px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes float { 0% { transform: translateY(0); } 50% { transform: translateY(-10px); } 100% { transform: translateY(0); } }
        .animate-float { animation: float 3.5s ease-in-out infinite; }
        .animate-slide-in { animation: slide-in 0.6s cubic-bezier(0.22, 1, 0.36, 1) forwards; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center">

    <div id="laser-probe"></div>

    <!-- éŸ³æ¨‚æ§åˆ¶éˆ• -->
    <div onclick="window.toggleMusic()" class="fixed bottom-6 right-6 z-[1000] w-14 h-14 glass rounded-full flex items-center justify-center cursor-pointer shadow-lg hover:scale-110 transition-transform border border-blue-50">
        <span id="music-icon" class="text-2xl">ğŸ”‡</span>
    </div>

    <!-- é ‚éƒ¨è³‡è¨Šçœ‹æ¿ -->
    <div class="fixed top-6 w-full max-w-md px-6 flex justify-between items-center z-[100]">
        <div class="glass px-6 py-3 rounded-full flex items-center gap-3 shadow-lg border-blue-50">
            <span class="text-2xl">ğŸ’°</span><span class="gold-val font-black text-slate-700 text-lg">0</span>
        </div>
        <div class="glass px-7 py-3 rounded-full flex flex-col items-center shadow-lg border-blue-50">
            <span class="career-val text-[11px] font-black text-blue-600 uppercase tracking-tighter text-center">æ­£åœ¨èªè­‰...</span>
            <span class="level-val text-[10px] font-bold text-slate-400 italic">Evolution</span>
        </div>
    </div>

    <!-- 0. Loading è¦–åœ– (ç™»å…¥ä¸­) -->
    <div id="view-loading" class="flex flex-col items-center">
        <div class="w-16 h-16 border-4 border-blue-100 border-t-blue-500 rounded-full animate-spin mb-8"></div>
        <p class="text-slate-400 font-black text-sm tracking-[0.4em] uppercase text-center italic animate-pulse">ç™»å…¥ä¸­...</p>
    </div>

    <!-- 1. Login è¦–åœ– -->
    <div id="view-login" class="hidden flex flex-col items-center">
        <div class="w-28 h-28 bg-white rounded-[3rem] flex items-center justify-center mb-12 shadow-xl border border-blue-50"><span class="text-7xl">ğŸ§Š</span></div>
        <h1 class="text-5xl font-black text-slate-800 mb-2 tracking-tighter">ç€…ç™½ä¹‹å¢ƒ</h1>
        <p class="text-slate-400 text-xs mb-12 font-black tracking-[0.3em] uppercase">Identity Verification</p>
        <div class="space-y-4 w-72 flex flex-col items-center">
            <button onclick="window.loginGoogle()" class="w-full py-5 bg-white border border-slate-100 rounded-3xl flex items-center justify-center gap-4 shadow-sm hover:bg-blue-50 transition-all font-black text-slate-600">Google å¿«é€Ÿèªè­‰</button>
            <button onclick="window.loginGuest()" class="w-full py-5 bg-blue-50 text-blue-600 font-black rounded-3xl hover:bg-blue-100 transition-all">è¨ªå®¢è©¦ç©æ¨¡å¼</button>
            <p class="text-[10px] text-slate-400 mt-4 text-center px-4 leading-relaxed italic">â€» è¨ªå®¢æ¨¡å¼ä¹‹é€²åº¦ç„¡æ³•è·¨å¹³å°ä¿å­˜</p>
        </div>
    </div>

    <!-- 2. Lobby è¦–åœ– -->
    <div id="view-lobby" class="hidden flex flex-col items-center">
        <div class="w-36 h-36 bg-white rounded-[4rem] flex items-center justify-center mb-12 shadow-2xl border-4 border-blue-50 rotate-3 transition-transform hover:rotate-0"><span class="text-7xl">ğŸ’</span></div>
        <h1 class="text-6xl font-black text-slate-800 tracking-tighter mb-1">ç€…ç™½ä¹‹å¢ƒ</h1>
        <p class="text-blue-400 font-black tracking-[0.5em] text-xs uppercase mb-12 italic">The Art of Pureness</p>
        <div class="glass p-8 rounded-[3rem] mb-12 text-center min-w-[300px] border-blue-100/50 shadow-inner">
            <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 italic">èªè­‰é¡§å•</p>
            <p class="user-name font-black text-slate-700 text-2xl italic truncate px-2">---</p>
        </div>
        <button onclick="switchView('appointments')" class="w-80 py-7 brand-btn text-3xl rounded-[2.5rem] shadow-2xl hover:scale-105 active:scale-95">é ç´„æ’ç¨‹ç®¡ç†</button>
        <button onclick="window.logout()" class="mt-8 text-slate-300 font-black text-sm tracking-widest hover:text-red-400">Logout</button>
    </div>

    <!-- 2.5 ä»Šæ—¥é ç´„è¡¨ -->
    <div id="view-appointments" class="hidden flex-col items-center w-full max-w-lg p-6">
        <div class="glass w-full p-10 rounded-[4.5rem] shadow-2xl border border-blue-50">
            <div class="flex items-end justify-between mb-8"><h2 class="text-3xl font-black text-slate-800 tracking-tighter underline decoration-blue-200 decoration-4">ä»Šæ—¥é ç´„è¡¨</h2><span class="text-[10px] font-black text-blue-300 uppercase mb-1 italic">Schedule</span></div>
            <div id="appointment-list" class="space-y-4 max-h-[450px] overflow-y-auto pr-4 custom-scrollbar"></div>
            <button onclick="switchView('lobby')" class="w-full mt-10 py-5 text-slate-400 font-black text-sm uppercase italic hover:text-blue-500">è¿”å›æ²™é¾å¤§å»³</button>
        </div>
    </div>

    <!-- 3. RPG å°è©±è¦–åœ– -->
    <div id="view-dialogue" class="hidden fixed inset-0 flex flex-col items-center justify-end p-10 bg-slate-900/15 backdrop-blur-md">
        <div class="glass w-full max-w-2xl p-12 rounded-[5rem] shadow-2xl flex items-start gap-12 border-blue-50 animate-slide-in">
            <div id="diag-avatar-box" class="w-36 h-36 bg-white rounded-[3.5rem] flex-shrink-0 border border-blue-100 p-3 shadow-inner"></div>
            <div class="flex-1">
                <h4 id="diag-name" class="font-black text-blue-500 text-xl mb-2 italic underline decoration-blue-100 decoration-4">é¡§å®¢</h4>
                <p id="diag-text" class="text-slate-700 font-bold leading-relaxed text-2xl min-h-[4.5em] mb-10 italic">...</p>
                <div id="diag-options" class="flex flex-col"></div>
            </div>
        </div>
    </div>

    <!-- 4. å®šåˆ¶è©•ä¼°è¦–åœ– -->
    <div id="view-selection" class="hidden flex-col items-center w-full max-w-5xl px-4">
        <div class="glass p-16 rounded-[6rem] flex flex-col md:flex-row gap-20 items-center shadow-2xl border-blue-50 animate-slide-in">
            <div class="w-72 h-[550px]">
                <svg viewBox="0 0 200 500" class="w-full h-full drop-shadow-2xl">
                    <circle cx="100" cy="55" r="45" class="hotspot" data-id="face" onclick="selectPart('face')" />
                    <circle cx="55" cy="125" r="28" class="hotspot" data-id="underarm" onclick="selectPart('underarm')" />
                    <circle cx="145" cy="125" r="28" class="hotspot" data-id="underarm" onclick="selectPart('underarm')" />
                    <rect x="75" y="160" width="50" height="120" rx="25" class="hotspot" data-id="others" onclick="selectPart('others')" />
                    <path d="M75 285 L125 285 L100 340 Z" class="hotspot" data-id="bikini" onclick="selectPart('bikini')" />
                    <rect x="25" y="130" width="24" height="185" rx="12" class="hotspot" data-id="limbs" onclick="selectPart('limbs')" />
                    <rect x="150" y="130" width="24" height="185" rx="12" class="hotspot" data-id="limbs" onclick="selectPart('limbs')" />
                    <rect x="70" y="345" width="28" height="200" rx="14" class="hotspot" data-id="limbs" onclick="selectPart('limbs')" />
                    <rect x="102" y="345" width="28" height="200" rx="14" class="hotspot" data-id="limbs" onclick="selectPart('limbs')" />
                </svg>
            </div>
            <div class="w-full max-w-md space-y-10 text-center md:text-left">
                <h3 class="text-5xl font-black text-slate-800 tracking-tighter italic">å®šåˆ¶å°ˆæ¥­è©•ä¼°</h3>
                <div id="selection-detail"></div>
                <div class="space-y-4">
                    <button onclick="confirmStart()" class="w-full py-7 brand-btn text-3xl rounded-[3rem] shadow-xl hover:scale-105 active:scale-95">å•Ÿå‹•é«˜æ•ˆé›·å°„</button>
                    <button onclick="switchView('appointments')" class="w-full text-slate-400 font-black text-sm uppercase italic hover:text-blue-500">é‡æ–°æª¢è¦–é ç´„è¡¨</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 5. é™¤æ¯›äº’å‹•äº’å‹•è¦–åœ– -->
    <div id="view-game" class="hidden flex flex-col items-center animate-slide-in">
        <div class="mb-12 w-96 text-center">
            <div class="w-full h-5 bg-white rounded-full overflow-hidden shadow-inner border-4 border-blue-50">
                <div id="prog-bar" class="h-full bg-gradient-to-r from-blue-400 to-cyan-400 transition-all duration-300" style="width: 0%"></div>
            </div>
            <p class="text-[11px] font-black text-blue-500 mt-4 uppercase tracking-[0.5em] animate-pulse">Laser Protocol Active</p>
        </div>
        <canvas id="game-canvas" class="cursor-none"></canvas>
    </div>

    <!-- çµç®—å½ˆçª— -->
    <div id="result-modal" class="hidden fixed inset-0 z-[200] items-center justify-center bg-blue-900/70 backdrop-blur-xl px-4 animate-slide-in">
        <div class="bg-white rounded-[6rem] p-20 text-center shadow-2xl max-md w-full border-4 border-blue-50 relative overflow-hidden">
            <div class="absolute -top-10 -left-10 w-40 h-40 bg-blue-50 rounded-full opacity-50 blur-3xl"></div>
            <div class="text-9xl mb-12">ğŸ§Š</div>
            <h3 class="text-5xl font-black text-slate-800 mb-4 tracking-tighter">æ¥µè‡´ç€…ç™½ï¼</h3>
            <p class="text-slate-400 font-bold mb-12 leading-relaxed text-lg px-6 italic">æ•¸æ“šåŒæ­¥å®Œæˆï¼Œé‚å‘æ¥µè‡´ç´”æ·¨ã€‚</p>
            <div class="bg-blue-50 p-8 rounded-[3.5rem] border border-blue-100 flex justify-between items-center mb-14 shadow-inner">
                <span class="font-black text-slate-500 uppercase tracking-widest text-xs">Reward Balance</span>
                <span class="font-black text-blue-600 text-5xl tracking-tighter font-mono">ğŸ’° <span id="reward-val">0</span></span>
            </div>
            <button onclick="location.reload()" class="w-full py-7 brand-btn text-2xl rounded-[3rem] shadow-xl font-black hover:scale-105 active:scale-95 transition-transform">ä¸‹ä¸€ä½é ç´„è²´è³“</button>
        </div>
    </div>

</body>
</html>
