<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç€…ç™½ä¹‹å¢ƒ Pure Skin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
        // --- Firebase SDK æ¨¡çµ„åŒ–å°å…¥ ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, 
            signInAnonymously, 
            signInWithPopup, 
            GoogleAuthProvider, 
            OAuthProvider, 
            onAuthStateChanged,
            setPersistence,
            browserLocalPersistence,
            signOut 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Firebase å°ˆæ¡ˆé…ç½® (pure-skin-8640d) ---
        const firebaseConfig = {
            apiKey: "AIzaSyCIKSbaZ5R6RTSRcH_-YYfqz_OnQQFr1gc",
            authDomain: "pure-skin-8640d.firebaseapp.com",
            projectId: "pure-skin-8640d",
            storageBucket: "pure-skin-8640d.firebasestorage.app",
            messagingSenderId: "890613609117",
            appId: "1:890613609117:web:ed044e453e6cc789b01a74",
            measurementId: "G-27E3XSTTBH"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = "pure-skin-studio-master";

        // --- éŸŒæ€§è¼‰å…¥ï¼šæœ¬åœ°å‚™æ´é…ç½® (FALLBACK_CONFIG) ---
        const FALLBACK_CONFIG = {
            bodyParts: {
                face: { name: 'è‡‰éƒ¨ç™‚ç¨‹', icon: 'ğŸ‘¤', cost: 100, desc: 'ç´°ç·»è™•ç†é¢éƒ¨é›œæ¯›ï¼Œæå‡å¦æ„Ÿé€äº®åº¦ã€‚' },
                underarm: { name: 'è…‹ä¸‹è­·ç†', icon: 'âœ¨', cost: 150, desc: 'æƒé™¤é»‘é ­æ²‰ç©ï¼Œé‡ç¾æ·¨ç™½æ¸…çˆ½ã€‚' },
                bikini: { name: 'VIO ç§å¯†', icon: 'ğŸ‘™', cost: 480, desc: 'æ¥µè‡´è¦ªè†šæŠ€è¡“ï¼Œæº«æŸ”å‘µè­·æ•æ„Ÿåœ°å¸¶ã€‚' },
                limbs: { name: 'å››è‚¢é™¤æ¯›', icon: 'ğŸ¦µ', cost: 220, desc: 'é«˜æ•ˆèƒ½é‡è¼¸å‡ºï¼Œæ‰“é€ å¤§é¢ç©çµ²æ»‘è‚Œã€‚' },
                back: { name: 'èƒŒéƒ¨æ·¨ç™½', icon: 'ğŸ‘—', cost: 300, desc: 'è§£æ±ºè¦–è¦ºç›²é»ï¼Œå±•ç¾å®Œç¾ç„¡ç‘•èƒŒå½±ã€‚' },
                others: { name: 'ç´°ç¯€ç¾å­¸', icon: 'ğŸ€', cost: 120, desc: 'å¾Œé ¸é«®éš›ç·šèˆ‡è…¹éƒ¨ä¸‹è‚šç·šç²¾æº–å¾®é›•ã€‚' }
            },
            careerTitles: [
                "ç€…ç™½å¯¦ç¿’ç”Ÿ", "åˆç´šæŠ€å¸«", "è³‡æ·±é™¤æ¯›å¸«", "é¦–å¸­æŠ€è¡“å®˜", "é†«ç¾é¡§å•", 
                "é›·å°„ç‰©ç†å°ˆå®¶", "çš®è†šè‡¨åºŠé†«ç”Ÿ", "æŠ—è€ç ”ç©¶å“¡", "ç”Ÿç‰©çº–ç¶­å°ˆå®¶", "é†«å­¸ç¾å®¹é™¢é•·",
                "å©šç¦®é€ å‹å¸«", "æ™‚å°šé›œèªŒé¡§å•", "å¥½èŠå¡¢ç‰¹æ•ˆè­·ç†", "æ˜æ˜Ÿå¾¡ç”¨å¤§å¸«", "äººé«”ç¾å­¸å®¶",
                "æ²™é¾åº—é•·", "å“ç‰Œç¶“ç†", "é€£é–åº—å‰µå§‹äºº", "ç¾å®¹é›†åœ˜ CEO", "å…¨çƒç¾å­¸æ•™çˆ¶"
            ],
            stories: [
                { name: "æµ·é‚ŠéŠå®¢", avatar: "ğŸ‘©", text: ["ç€…ç™½ä¹‹å¢ƒä½ å¥½ï¼Œæˆ‘ä¸‹é€±è¦å»æ½›æ°´...", "å¯æ˜¯ VIO çš„éƒ¨ä½è®“æˆ‘å¾ˆå®³ç¾ã€‚", "è«‹å‹™å¿…å¹«æˆ‘è™•ç†å¾—ä¹¾ä¹¾æ·¨æ·¨ï¼"] },
                { name: "å¥èº«è·äºº", avatar: "ğŸ‘¨", text: ["æ•™çˆ¶ï¼Œæˆ‘åˆä¾†äº†ã€‚é€™æ¬¡å¹«æˆ‘è™•ç†å°è…¿ã€‚", "æ¯›é«®å¤ªå¤šæœƒå½±éŸ¿è‚Œè‚‰ç·šæ¢çš„è¦–è¦ºæ•ˆæœã€‚", "å ±é…¬æˆ‘å·²ç¶“æº–å‚™å¥½äº†ã€‚"] }
            ]
        };

        // --- å…¨å±€ç‹€æ…‹ç®¡ç† ---
        let state = {
            user: null,
            totalGold: 0,
            level: 1,
            exp: 0,
            careerIndex: 0,
            view: 'loading', 
            selectedGender: 'female',
            selectedPartId: 'face',
            // é›²ç«¯é©…å‹•æ•¸æ“š
            bodyParts: FALLBACK_CONFIG.bodyParts,
            careerTitles: FALLBACK_CONFIG.careerTitles,
            stories: FALLBACK_CONFIG.stories,
            isCleaning: false,
            currentStory: null,
            dialogueStep: 0,
            isDefinitionsLoaded: false,
            isMuted: true
        };

        // --- éŸ³é »ä¸­å¿ƒ ---
        const bgm = new Audio("https://assets.mixkit.co/music/preview/mixkit-serene-view-443.mp3");
        bgm.loop = true;

        window.toggleMusic = () => {
            state.isMuted = !state.isMuted;
            if (!state.isMuted) {
                bgm.play().catch(() => console.log("ç­‰å¾…äº’å‹•ä»¥æ’­æ”¾"));
            } else {
                bgm.pause();
            }
            document.getElementById('music-icon').innerText = state.isMuted ? "ğŸ”‡" : "ğŸ”Š";
        };

        // --- ç³»çµ±è¨Šæ¯ä»‹é¢ ---
        function showMessage(text, isError = false) {
            const box = document.getElementById('message-box');
            const content = document.getElementById('message-content');
            content.innerText = text;
            box.classList.remove('hidden');
            box.classList.add('flex');
            box.className = isError 
                ? "fixed top-10 left-1/2 -translate-x-1/2 z-[20000] px-8 py-4 rounded-3xl text-white font-bold shadow-2xl backdrop-blur-md items-center justify-center transition-all bg-red-500/90" 
                : "fixed top-10 left-1/2 -translate-x-1/2 z-[20000] px-8 py-4 rounded-3xl text-white font-bold shadow-2xl backdrop-blur-md items-center justify-center transition-all bg-blue-600/90";
            setTimeout(() => {
                box.classList.add('hidden');
                box.classList.remove('flex');
            }, 5000);
        }

        // --- åˆå§‹åŒ–å…¥å£ ---
        async function init() {
            // è¨­ç½®æŒä¹…åŒ–ï¼šç™»å…¥ä¸€æ¬¡å¾Œä¸éœ€å†é©—è­‰
            try {
                await setPersistence(auth, browserLocalPersistence);
            } catch (e) { console.warn("Persistence Error", e); }

            onAuthStateChanged(auth, async (currUser) => {
                if (currUser) {
                    state.user = currUser;
                    await syncDefinitions(); // ç•°æ­¥æŠ“å–é›²ç«¯å®šç¾©
                    await syncUserData();    // ç›£è½å€‹äººé€²åº¦
                    switchView('lobby');
                } else {
                    state.user = null;
                    await syncDefinitions(); // è¨ªå®¢ä¹Ÿéœ€å˜—è©¦è¼‰å…¥é…ç½®
                    switchView('login');
                }
            });

            // é›·å°„æ¢é ­åº§æ¨™æ ¡æº–
            const probe = document.getElementById('laser-probe');
            window.addEventListener('mousemove', (e) => {
                probe.style.left = `${e.clientX}px`;
                probe.style.top = `${e.clientY}px`;
            });
        }

        // --- éŸŒæ€§æ•¸æ“šåŒæ­¥ (V2.6 æ ¸å¿ƒä¿®æ”¹) ---
        async function syncDefinitions() {
            try {
                const defRef = doc(db, 'artifacts', appId, 'public', 'data', 'definitions');
                const snap = await getDoc(defRef);
                
                if (snap.exists()) {
                    const cloud = snap.data();
                    state.bodyParts = cloud.bodyParts || FALLBACK_CONFIG.bodyParts;
                    state.careerTitles = cloud.careerTitles || FALLBACK_CONFIG.careerTitles;
                    state.stories = cloud.stories || FALLBACK_CONFIG.stories;
                    console.log("é›²ç«¯é…ç½®è¼‰å…¥æˆåŠŸ");
                } else {
                    // è‹¥é›²ç«¯æ–‡ä»¶ä¸å­˜åœ¨ï¼Œå˜—è©¦åˆå§‹åŒ–å¯«å…¥é è¨­é›†
                    await setDoc(defRef, FALLBACK_CONFIG).catch(() => {
                        console.warn("å¯«å…¥æ¬Šé™å—é™ï¼Œå°‡ç¶­æŒæœ¬åœ°æ¨¡å¼é‹è¡Œã€‚");
                    });
                }
            } catch (err) {
                console.warn("ç„¡æ³•å–å¾—é›²ç«¯é…ç½®ï¼Œå·²å•Ÿç”¨æœ¬åœ°å‚™æ´æ•¸æ“šï¼š", err.message);
                // ç™¼ç”ŸéŒ¯èª¤ (å¦‚ Permission Denied) æ™‚ï¼Œå·²åœ¨ state é è¨­ FALLBACK_CONFIGï¼Œæ•…ç„¡éœ€é¡å¤–è™•ç†
            } finally {
                state.isDefinitionsLoaded = true;
                updateUI();
            }
        }

        async function syncUserData() {
            if (!state.user) return;
            const profileRef = doc(db, 'artifacts', appId, 'users', state.user.uid, 'saveData', 'profile');
            onSnapshot(profileRef, (snap) => {
                if (snap.exists()) {
                    const d = snap.data();
                    state.totalGold = d.totalGold || 0;
                    state.level = d.level || 1;
                    state.careerIndex = d.careerIndex || 0;
                    updateUI();
                }
            }, (err) => console.error("Firestore Listen Error:", err));
        }

        // --- èº«åˆ†èªè­‰æ¨¡çµ„ ---
        window.loginGoogle = async () => {
            showMessage("æ­£åœ¨å˜—è©¦å•Ÿå‹• Google èªè­‰...");
            const provider = new GoogleAuthProvider();
            try { await signInWithPopup(auth, provider); }
            catch (e) { 
                if (e.code === 'auth/popup-blocked') showMessage("å½ˆçª—è¢«æ””æˆªï¼Œè«‹å…è¨±æ­¤ç¶²åŸŸé–‹å•Ÿè¦–çª—ã€‚", true);
                else showMessage(`é©—è­‰ç•°å¸¸: ${e.code}`, true);
            }
        };

        window.loginGameCenter = async () => {
            const provider = new OAuthProvider('apple.com'); 
            try { await signInWithPopup(auth, provider); }
            catch (e) { showMessage("Game Center ç›®å‰åƒ…æ”¯æ´ Apple åŸç”Ÿç’°å¢ƒã€‚", true); }
        };

        window.loginGuest = async () => {
            try { await signInAnonymously(auth); }
            catch (e) { showMessage("ç³»çµ±é€£ç·šç¹å¿™ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚", true); }
        };

        window.logout = () => signOut(auth);

        // --- è¦–åœ–èˆ‡å°èˆªé‚è¼¯ ---
        function switchView(v) {
            state.view = v;
            const views = ['loading', 'login', 'lobby', 'dialogue', 'selection', 'game'];
            views.forEach(id => {
                const el = document.getElementById(`view-${id}`);
                if (el) {
                    el.classList.toggle('hidden', state.view !== id);
                    el.classList.toggle('flex', state.view === id);
                }
            });
            if (v === 'game') setTimeout(initCanvas, 100);
            updateUI();
        }

        function updateUI() {
            if (!state.isDefinitionsLoaded) return;
            document.querySelectorAll('.gold-val').forEach(el => el.innerText = state.totalGold);
            document.querySelectorAll('.level-val').forEach(el => el.innerText = `Lv.${state.level}`);
            
            // å‹•æ…‹è·ç¨±ï¼šæ¯ 2 ç´šæ™‰å‡ä¸€æ¬¡
            const careerName = state.careerTitles[state.careerIndex] || "ç€…ç™½æ–°äºº";
            document.querySelectorAll('.career-val').forEach(el => el.innerText = careerName);
            
            document.querySelectorAll('.user-name').forEach(el => el.innerText = state.user?.displayName || (state.user?.isAnonymous ? "è¨ªå®¢å­¸å“¡" : "ç€…ç™½é¡§å•"));
            
            if (state.view === 'selection') renderSelectionUI();
        }

        // --- RPG æœå‹™å•Ÿå‹•é‚è¼¯ ---
        window.startService = () => {
            if (!state.isDefinitionsLoaded || state.stories.length === 0) {
                showMessage("æ•¸æ“šè¼‰å…¥ä¸­ï¼Œè«‹ç¨å€™å†é»æ“Šã€‚", true);
                return;
            }
            state.currentStory = state.stories[Math.floor(Math.random() * state.stories.length)];
            state.selectedGender = state.currentStory.avatar === "ğŸ‘¨" ? "male" : "female";
            state.dialogueStep = 0;
            switchView('dialogue');
            showDialogue();
            if (!state.isMuted) bgm.play();
        };

        function showDialogue() {
            document.getElementById('diag-name').innerText = state.currentStory.name;
            document.getElementById('diag-avatar').innerText = state.currentStory.avatar;
            document.getElementById('diag-text').innerText = state.currentStory.text[state.dialogueStep];
        }

        window.nextDialogue = () => {
            state.dialogueStep++;
            if (state.dialogueStep < state.currentStory.text.length) showDialogue();
            else switchView('selection');
        };

        // --- äº’å‹•é™¤æ¯› Canvas å¼•æ“ ---
        let canvas, ctx;
        function initCanvas() {
            canvas = document.getElementById('game-canvas');
            if (!canvas) return;
            ctx = canvas.getContext('2d');
            canvas.width = 340;
            canvas.height = 440;
            
            canvas.onmousedown = (e) => { 
                state.isCleaning = true; 
                document.getElementById('laser-probe').classList.add('active');
                clean(e);
            };
            canvas.onmousemove = (e) => { if (state.isCleaning) clean(e); };
            window.onmouseup = () => { 
                state.isCleaning = false; 
                document.getElementById('laser-probe').classList.remove('active'); 
                checkProgress(); 
            };
            drawSkinLayer();
        }

        function clean(e) {
            const r = canvas.getBoundingClientRect();
            // ä¿®æ­£å…§åµŒè¦–çª—çš„åº§æ¨™åç§»
            const x = (e.clientX - r.left);
            const y = (e.clientY - r.top);
            
            ctx.globalCompositeOperation = 'destination-out';
            ctx.beginPath();
            ctx.arc(x, y, 25, 0, Math.PI * 2);
            ctx.fill();
        }

        function drawSkinLayer() {
            ctx.globalCompositeOperation = 'source-over';
            ctx.fillStyle = state.selectedGender === 'male' ? '#f4d1c1' : '#fff0f0';
            ctx.fillRect(0, 0, 340, 440);
            ctx.strokeStyle = "#4a3a2a";
            ctx.lineWidth = 0.8;
            const density = state.selectedPartId === 'bikini' ? 3800 : 2500;
            for (let i = 0; i < density; i++) {
                const x = Math.random() * 340;
                const y = Math.random() * 440;
                ctx.beginPath(); ctx.moveTo(x, y); ctx.lineTo(x + (Math.random()-0.5)*2, y + 6); ctx.stroke();
            }
        }

        function checkProgress() {
            const data = ctx.getImageData(0, 0, 340, 440).data;
            let opaque = 0;
            for (let i = 3; i < data.length; i += 4) if (data[i] > 0) opaque++;
            const progress = 1 - (opaque / (340 * 440));
            document.getElementById('prog-bar').style.width = `${progress * 100}%`;
            if (progress > 0.98) finalizeSession();
        }

        async function finalizeSession() {
            const part = state.bodyParts[state.selectedPartId];
            let reward = part.cost;
            if (state.selectedGender === 'male') reward *= 1.2;
            
            state.totalGold += Math.floor(reward);
            state.exp += 50;
            
            if (state.exp >= 100) {
                state.level++;
                state.exp = 0;
                state.careerIndex = Math.min(Math.floor(state.level / 2), 19);
            }

            if (state.user) {
                const ref = doc(db, 'artifacts', appId, 'users', state.user.uid, 'saveData', 'profile');
                await setDoc(ref, { totalGold: state.totalGold, level: state.level, careerIndex: state.careerIndex }, { merge: true });
            }

            document.getElementById('reward-val').innerText = Math.floor(reward);
            document.getElementById('result-modal').style.display = 'flex';
        }

        function renderSelectionUI() {
            const p = state.bodyParts[state.selectedPartId];
            document.getElementById('selection-detail').innerHTML = `
                <div class="p-6 bg-blue-50/60 rounded-[2.5rem] border border-blue-100 shadow-inner">
                    <h3 class="text-2xl font-black text-blue-600 mb-1">${p.icon} ${p.name}</h3>
                    <p class="text-xs text-slate-500 font-medium leading-relaxed">${p.desc}</p>
                    <div class="mt-4 flex justify-between items-center border-t border-blue-100 pt-4">
                        <span class="text-xs font-bold text-slate-400 uppercase tracking-widest">å ±é…¬é è¦½</span>
                        <span class="text-xl font-black text-blue-800 font-mono">ğŸ’° ${p.cost}</span>
                    </div>
                </div>
            `;
            document.querySelectorAll('.hotspot').forEach(el => el.classList.toggle('active', el.dataset.id === state.selectedPartId));
        }

        window.onload = init;
        window.switchView = switchView;
        window.selectPart = (id) => { state.selectedPartId = id; renderSelectionUI(); };
        window.confirmStart = () => switchView('game');
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background: #fcfdfe; cursor: none; overflow: hidden; margin: 0; user-select: none; }
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(25px); border: 1px solid rgba(255, 255, 255, 0.6); }
        
        /* å°ˆæ¥­é›·å°„æ¢é ­ */
        #laser-probe {
            position: fixed; width: 54px; height: 54px; border: 3px solid #3b82f6; border-radius: 50%;
            pointer-events: none; z-index: 10000; transform: translate(-50%, -50%);
            background: rgba(59, 130, 246, 0.1); box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
            transition: transform 0.1s ease-out;
        }
        #laser-probe.active { transform: translate(-50%, -50%) scale(0.8); background: rgba(59, 130, 246, 0.6); box-shadow: 0 0 40px #3b82f6; }
        #laser-probe::after { content: ''; position: absolute; top: 50%; left: 50%; width: 4px; height: 4px; background: white; border-radius: 50%; transform: translate(-50%, -50%); }

        .brand-btn { background: linear-gradient(135deg, #a5f3fc 0%, #e0f2fe 100%); color: #0369a1; font-weight: 900; cursor: pointer; transition: 0.3s; }
        .brand-btn:hover { transform: translateY(-3px); box-shadow: 0 10px 25px rgba(186, 230, 253, 0.5); filter: brightness(1.05); }

        .hotspot { fill: #f1f5f9; stroke: #e2e8f0; cursor: pointer; transition: 0.3s; }
        .hotspot:hover { fill: #dcfce7; }
        .hotspot.active { fill: #3b82f6; stroke: #1d4ed8; stroke-width: 2.5; filter: drop-shadow(0 0 10px rgba(59, 130, 246, 0.5)); }

        canvas { border-radius: 4.5rem; border: 10px solid white; box-shadow: 0 30px 70px rgba(186, 230, 253, 0.2); }
        .fade-in { animation: fadeIn 0.6s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center">

    <div id="laser-probe"></div>

    <!-- ç³»çµ±é€šçŸ¥ä¸­å¿ƒ -->
    <div id="message-box" class="hidden fixed top-10 left-1/2 -translate-x-1/2 z-[20000] px-8 py-4 rounded-3xl text-white font-bold shadow-2xl backdrop-blur-md items-center justify-center transition-all animate-bounce">
        <span id="message-content"></span>
    </div>

    <!-- éŸ³æ¨‚æ§åˆ¶æŒ‰éˆ• -->
    <div onclick="window.toggleMusic()" class="fixed bottom-6 right-6 z-[1000] w-12 h-12 glass rounded-full flex items-center justify-center cursor-pointer shadow-lg hover:scale-110 transition-transform border border-blue-50">
        <span id="music-icon" class="text-xl">ğŸ”‡</span>
    </div>

    <!-- é ‚éƒ¨ç‹€æ…‹åˆ— -->
    <div class="fixed top-6 w-full max-w-md px-6 flex justify-between items-center z-[100]">
        <div class="glass px-5 py-2 rounded-full flex items-center gap-3 shadow-lg border-blue-50">
            <span class="text-xl">ğŸ’°</span>
            <span class="gold-val font-black text-slate-700">0</span>
        </div>
        <div class="glass px-6 py-2 rounded-full flex flex-col items-center shadow-lg border-blue-50">
            <span class="career-val text-[11px] font-black text-blue-500 uppercase italic tracking-tighter text-center">ç€…ç™½å­¸å“¡</span>
            <span class="level-val text-[9px] font-bold text-slate-400">Lv.1</span>
        </div>
    </div>

    <!-- 0. ç³»çµ±è¼‰å…¥è¦–åœ– -->
    <div id="view-loading" class="flex flex-col items-center">
        <div class="w-16 h-16 border-4 border-blue-100 border-t-blue-500 rounded-full animate-spin mb-6"></div>
        <p class="text-slate-400 font-bold text-xs tracking-[0.3em] uppercase text-center leading-relaxed">
            Pure Skin Evolution<br>æ­£åœ¨åŒæ­¥é›²ç«¯ç¾å­¸é…ç½®...
        </p>
    </div>

    <!-- 1. ç™»å…¥è¦–åœ– -->
    <div id="view-login" class="hidden flex flex-col items-center fade-in">
        <div class="w-24 h-24 bg-blue-50 rounded-[2.5rem] flex items-center justify-center mb-10 shadow-inner">
            <span class="text-6xl text-blue-300">ğŸ§Š</span>
        </div>
        <h1 class="text-4xl font-black text-slate-800 mb-2 tracking-tighter">ç€…ç™½ä¹‹å¢ƒ</h1>
        <p class="text-slate-400 text-xs mb-10 font-bold tracking-[0.3em] uppercase">Identity Verification</p>
        
        <div class="space-y-4 w-64 flex flex-col items-center">
            <button onclick="window.loginGoogle()" class="w-full py-4 bg-white border border-slate-100 rounded-2xl flex items-center justify-center gap-3 shadow-sm hover:bg-blue-50 transition-all">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/action/google.svg" width="20">
                <span class="font-bold text-slate-600">Google å¿«é€Ÿç™»å…¥</span>
            </button>
            <button onclick="window.loginGameCenter()" class="w-full py-4 bg-slate-900 text-white rounded-2xl flex items-center justify-center gap-3 shadow-sm hover:bg-black transition-all">
                <span class="text-xl">ğŸ®</span>
                <span class="font-bold">Game Center</span>
            </button>
            <div class="w-full flex flex-col items-center mt-6">
                <button onclick="window.loginGuest()" class="w-full py-4 bg-blue-50 text-blue-500 font-black rounded-2xl hover:bg-blue-100 transition-all">è¨ªå®¢è©¦ç©æ¨¡å¼</button>
                <p class="text-[9px] text-slate-400 mt-2 text-center leading-relaxed">å‚™è¨»ï¼šè¨ªå®¢æ¨¡å¼ç„¡æ³•è·¨è£ç½®å®Œæ•´ç´€éŒ„æ‚¨çš„é€²åº¦</p>
            </div>
        </div>
    </div>

    <!-- 2. æ²™é¾å¤§å»³ -->
    <div id="view-lobby" class="hidden flex flex-col items-center fade-in">
        <div class="w-32 h-32 bg-white rounded-[3.5rem] flex items-center justify-center mb-10 shadow-2xl border-4 border-blue-50 rotate-3">
            <span class="text-6xl">ğŸ’</span>
        </div>
        <h1 class="text-5xl font-black text-slate-800 tracking-tighter mb-1">ç€…ç™½ä¹‹å¢ƒ</h1>
        <p class="text-blue-400 font-black tracking-[0.5em] text-[10px] uppercase mb-12">Pure Skin Evolution</p>
        
        <div class="glass p-6 rounded-[2.5rem] mb-10 text-center min-w-[260px] border-blue-100/50">
            <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1">èªè­‰é¡§å•</p>
            <p class="user-name font-black text-slate-700 text-xl italic truncate max-w-[220px]">---</p>
        </div>

        <div class="flex flex-col gap-4 w-64">
            <button onclick="window.startService()" class="w-full py-6 brand-btn text-2xl rounded-full shadow-2xl">æ¥å¾…é ç´„å®¢</button>
            <button onclick="window.logout()" class="w-full py-3 text-slate-400 font-bold text-sm hover:text-red-400">é€€å‡ºç³»çµ±</button>
        </div>
    </div>

    <!-- 3. RPG åŠ‡æƒ…å°è©± -->
    <div id="view-dialogue" class="hidden fixed inset-0 flex flex-col items-center justify-end p-10 bg-slate-900/5">
        <div class="glass w-full max-w-2xl p-10 rounded-[4rem] shadow-2xl flex items-center gap-10 fade-in border-blue-100">
            <div id="diag-avatar" class="text-8xl bg-white w-28 h-28 rounded-3xl flex items-center justify-center shadow-inner border border-blue-50">ğŸ‘©</div>
            <div class="flex-1">
                <h4 id="diag-name" class="font-black text-blue-500 text-lg mb-1 italic tracking-widest underline decoration-2 decoration-blue-200">é¡§å®¢</h4>
                <p id="diag-text" class="text-slate-700 font-medium leading-relaxed text-xl min-h-[3.5em]">...</p>
                <button onclick="window.nextDialogue()" class="mt-6 float-right px-10 py-3 bg-slate-900 text-white font-black rounded-2xl hover:bg-black transition-all">ç¹¼çºŒ Next â¯</button>
            </div>
        </div>
    </div>

    <!-- 4. å…¨èº«éƒ¨ä½å°è¦½ -->
    <div id="view-selection" class="hidden flex flex-col items-center w-full max-w-4xl px-4 fade-in">
        <div class="glass p-12 rounded-[5.5rem] flex flex-col md:flex-row gap-16 items-center shadow-2xl border-blue-50">
            <div class="w-64 h-[500px]">
                <svg viewBox="0 0 200 500" class="w-full h-full drop-shadow-2xl">
                    <circle cx="100" cy="55" r="40" class="hotspot" data-id="face" onclick="selectPart('face')" />
                    <circle cx="55" cy="120" r="24" class="hotspot" data-id="underarm" onclick="selectPart('underarm')" />
                    <circle cx="145" cy="120" r="24" class="hotspot" data-id="underarm" onclick="selectPart('underarm')" />
                    <rect x="75" y="150" width="50" height="115" rx="22" class="hotspot" data-id="others" onclick="selectPart('others')" />
                    <path d="M75 265 L125 265 L100 320 Z" class="hotspot" data-id="bikini" onclick="selectPart('bikini')" />
                    <rect x="30" y="125" width="22" height="175" rx="11" class="hotspot" data-id="limbs" onclick="selectPart('limbs')" />
                    <rect x="148" y="125" width="22" height="175" rx="11" class="hotspot" data-id="limbs" onclick="selectPart('limbs')" />
                    <rect x="73" y="325" width="26" height="190" rx="13" class="hotspot" data-id="limbs" onclick="selectPart('limbs')" />
                    <rect x="101" y="325" width="26" height="190" rx="13" class="hotspot" data-id="limbs" onclick="selectPart('limbs')" />
                </svg>
            </div>
            <div class="w-full max-w-xs space-y-8 text-center md:text-left">
                <h3 class="text-4xl font-black text-slate-800 tracking-tighter italic">å®šåˆ¶å°ˆæ¥­ç™‚ç¨‹</h3>
                <div id="selection-detail"></div>
                <div class="space-y-4 pt-6">
                    <button onclick="confirmStart()" class="w-full py-6 brand-btn text-2xl rounded-[2.5rem] shadow-xl">é–‹å§‹å°ˆæ¥­ç™‚ç¨‹</button>
                    <button onclick="switchView('lobby')" class="w-full text-slate-400 font-bold text-sm tracking-widest uppercase">è¿”å›å¤§å»³</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 5. é™¤æ¯›äº’å‹•å ´æ™¯ -->
    <div id="view-game" class="hidden flex flex-col items-center fade-in">
        <div class="mb-10 w-80 text-center">
            <div class="w-full h-4 bg-slate-100 rounded-full overflow-hidden shadow-inner border-4 border-white">
                <div id="prog-bar" class="h-full brand-btn transition-all duration-300" style="width: 0%"></div>
            </div>
            <p class="text-[10px] font-black text-blue-400 mt-2 uppercase tracking-[0.3em]">Pure Laser Protocol Active</p>
        </div>
        <canvas id="game-canvas"></canvas>
    </div>

    <!-- çµç®—å½ˆçª— -->
    <div id="result-modal" class="hidden fixed inset-0 z-[200] items-center justify-center bg-blue-900/60 backdrop-blur-xl px-4">
        <div class="bg-white rounded-[5.5rem] p-16 text-center shadow-2xl max-sm w-full animate-in zoom-in border-4 border-blue-50">
            <div class="text-8xl mb-10">ğŸ§Š</div>
            <h3 class="text-4xl font-black text-slate-800 mb-4 tracking-tighter">æ¥µè‡´ç€…ç™½ï¼</h3>
            <p class="text-slate-400 font-bold mb-10 leading-relaxed">æ‚¨çš„å°ˆæ¥­æ•¸æ“šå·²åŒæ­¥è‡³é›²ç«¯ç¾å­¸ä¸­å¿ƒ</p>
            <div class="bg-blue-50 p-7 rounded-[3rem] border border-blue-100 flex justify-between items-center mb-12 shadow-inner">
                <span class="font-bold text-slate-500 uppercase tracking-widest text-xs">Settled Bonus</span>
                <span class="font-black text-blue-600 text-4xl tracking-tighter font-mono">ğŸ’° <span id="reward-val">0</span></span>
            </div>
            <button onclick="location.reload()" class="w-full py-6 brand-btn text-2xl rounded-[2.5rem] shadow-xl">æ¥å¾…ä¸‹ä¸€ä½é ç´„</button>
        </div>
    </div>

</body>
</html>
